machine:
  python:
    version: 2.7.13
  services:
    - postgresql

dependencies:
  override:
    - pip install --no-binary psycopg2

database:
  override:
    - createdb tdo
    - echo "CREATE TABLE USERS (SALT CHARACTER(16) PRIMARY KEY, ALIAS VARCHAR(16) NOT NULL, PASS CHARACTER(64));" | psql -U postgres
    - echo "CREATE ROLE api WITH UNENCRYPTED PASSWORD 'password';" | psql -U postgres
    - echo "ALTER ROLE api WITH LOGIN;" | psql -U postgres
    - echo "GRANT SELECT, UPDATE, INSERT, DELETE ON ALL TABLES IN SCHEMA public TO api;" | psql -U postgres
    - echo "GRANT CREATE, CONNECT ON DATABASE tdo TO api;" | psql -U postgres
